<%- include("partials/header"); -%>
<div class="container-fluid" style="padding: 120px 8%;">

    <div class="row">

      <!-- Post Content Column -->
      <div class="col-lg-8 col">
        <!--Content-->
        <div class="row" style="padding-top: 0;">
          <div class="col-12">
            <!-- Title -->
            <h1 class="mt-4"><%= postDoc[0].title %></h1>

            <!-- Author -->
            <p class="lead">
              by
              <a href="#"><%= postDoc[0].author %></a>
            </p>

            <hr>

            <!-- Date/Time -->
            <% const options= {year: 'numeric', month:'long', day: 'numeric'} %>
            <p>Posted on <%= postDoc[0].createdAt.toLocaleDateString("en-US",options) %> at <%= postDoc[0].createdAt.toLocaleTimeString("en-US") %> </p>

            <hr>

            <!-- Preview Image -->
            <img class="img-fluid rounded" src="<%= postDoc[0].image %>" alt="<%= postDoc.title %>">

            <hr>

            <!-- Post Content -->
            <div class="content"><%-postDoc[0].content %></div>
            <p class="lead">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ducimus, vero, obcaecati, aut, error quam sapiente nemo saepe quibusdam sit excepturi nam quia corporis eligendi eos magni recusandae laborum minus inventore?</p>

            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ut, tenetur natus doloremque laborum quos iste ipsum rerum obcaecati impedit odit illo dolorum ab tempora nihil dicta earum fugiat. Temporibus, voluptatibus.</p>

            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eos, doloribus, dolorem iusto blanditiis unde eius illum consequuntur neque dicta incidunt ullam ea hic porro optio ratione repellat perspiciatis. Enim, iure!</p>

            <blockquote class="blockquote">
              <p class="mb-0">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer posuere erat a ante.</p>
              <footer class="blockquote-footer">Someone famous in
                <cite title="Source Title">Source Title</cite>
              </footer>
            </blockquote>

            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Error, nostrum, aliquid, animi, ut quas placeat totam sunt tempora commodi nihil ullam alias modi dicta saepe minima ab quo voluptatem obcaecati?</p>

            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Harum, dolor quis. Sunt, ut, explicabo, aliquam tenetur ratione tempore quidem voluptates cupiditate voluptas illo saepe quaerat numquam recusandae? Qui, necessitatibus, est!</p>

            <hr>
          </div>
        </div>

        <!--Related Post-->
        <div class="row content-row">
          <!--title row-->
          <div class="row category-title">
            <div class="category-title-text"><a href="/category/<%= postDoc[0].tag %>">Related Post</a></div>
            <div class="line"><span></span></div>
          </div>
          <!--Category content-->
          <div class="row category-content">
            <%for(let i=0; i<relatedDoc.length; i++){ %>
              <% let PostTitle=relatedDoc[i].title %>
              <% if(PostTitle.length > 72){%>
                <%PostTitle=PostTitle.substr(0,72)+"..."%>
              <%}%>
              <!--Applying different padding for the first and last element-->
              <% if(i===0){%>
                <div class="col-sm-12 col-md-4 col-item " style="padding-left:0; padding-right: 7px;">
                  <div class="card mb-4 w3-card">
                    <div class="col-img card-img-top">
                      <img class="" src="<%= relatedDoc[i].image %>" alt="<%= relatedDoc[i].title %>">
                    </div>
                    <div class="card-body">
                      <h3 class="card-title"><%= PostTitle %></h3>
                      <a href="/category/<%= relatedDoc[i].category %>/<%= relatedDoc[i]._id %>" class="readmore"> Read More <i class="fas fa-angle-right"></i></a>
                    </div>
                  </div>
                </div>
              <%}else if(i===2){%>
                <div class="col-sm-12 col-md-4 col-item" style="padding-right: 0;padding-left: 7px;">
                  <div class="card mb-4 w3-card">
                    <div class="col-img card-img-top">
                      <img class="" src="<%= relatedDoc[i].image %>" alt="<%= relatedDoc[i].title %>">
                    </div>
                    <div class="card-body">
                      <h3 class="card-title"><%= PostTitle %></h3>
                      <a href="/category/<%= relatedDoc[i].category %>/<%= relatedDoc[i]._id %>" class="readmore"> Read More <i class="fas fa-angle-right"></i></a>
                    </div>
                  </div>
                </div>
              <%}else{%>
                <div class="col-sm-12 col-md-4 col-item" style="padding: 2px;">
                  <div class="card mb-4 w3-card">
                    <div class="col-img card-img-top">
                      <img class="" src="<%= relatedDoc[i].image %>" alt="<%= relatedDoc[i].title %>">
                    </div>
                    <div class="card-body">
                      <h3 class="card-title"><%= PostTitle %></h3>
                      <a href="/category/<%= relatedDoc[i].category %>/<%= relatedDoc[i]._id %>" class="readmore"> Read More <i class="fas fa-angle-right"></i></a>
                    </div>
                  </div>
                </div>

              <%}%>
              
            <%}%>
            
          </div>
          
          
          <!--Read more button-->
          <div class="row read-more">
            <div class="col-12"><button class="btn readmore-btn"><a href="/category/<%= postDoc[0].tag %>" class=""> Read More <i class="fas fa-angle-down"></i></a> </button></div>
          </div>
        </div>

        <!--Comment inputs-->
        <div class="row row-content">
          <div class="comment-input">
            <h6 class="comment-title">Your email address will not be pushed. Required fields are marked</h6>
            <div class="comment-input">
              <form action="/comment" method="POST">
                <div class="form-group">
                  <textarea class="form-control" rows="8" name="content" placeholder="Your Comment" style="border: 1px solid black;"></textarea>
                </div>
                <div class="form-group login">
                  <div class="guest">
                    <h5>Post as Guest</h5>
                    <input type="text" class="form-control" name="fname" placeholder="FirstName" required style="border: 1px solid black;">
                    <input type="text" class="form-control" name="lname" placeholder="LastName" required style="border: 1px solid black;">
                    <input type="email" class="form-control" name="email" placeholder="Email" required style="border: 1px solid black;">
                    <input type="hidden" name="postId" value="<%= postDoc[0]._id %>">
                    <input type="hidden" name="category" value="<%= postDoc[0].category %>">
                    <input type="hidden" name="title" value="<%= postDoc[0].title %>">
                  </div>
                  <div class="social-login">
                    <h5>Log in</h5>
                    <i class="fab fa-facebook-square"></i>
                    <i class="fab fa-google"></i>
                    <i class="fab fa-instagram"></i>
                    <i class="fab fa-twitter-square"></i>
                  </div>
                </div>
                <div class="form-group">
                  <button type="submit" class="btn btn-comment form-control">Comment</button>
                </div>
                
              </form>
            </div>
          </div>
        </div>

        <!--Comment Section-->
        <div class="row category-title">
          <div class="category-title-text"><%= commentDoc.length %> Comment(s)</div>
        </div>
        <div class="row row-content w3-card">
          <!--report Modal-->
          <div id="id01" class="w3-modal">
            <div class="w3-modal-content w3-animate-top w3-card-4" style="top: 30%;
            height: 150px; width: 35%; color: green; text-align: center; padding-top: 40px;">
              <span onclick="document.getElementById('id01').style.display='none'" 
                class="w3-button w3-display-topright" style="color:red;">&times;</span>
              <div class="w3-container">
                <p>You've successfully reported this comment!</p>
                <p>thanks for doing your part. we will take it up from here... <i class="fas fa-fist-raised"></i> </p>
              </div>
            </div>
          </div>
          <!--template goes here/ one full comment including replies-->
          <% let commentIndex=0 %>
          <% let replyIndex=0 %>
          <% commentDoc.forEach(function(comment){ %>
            <%commentIndex++%>
            <div class="comment-section">
              <!--user image section-->
              <div class="user-image">
                <img src="img/profile_avatar.png" alt="user-image">
              </div>
              <!--comment text section-->
              <div class="comment-text">
                <!--comment head-->
                <div class="row comment-header">
                  <% let option1={month: 'long', day: 'numeric'} %>
                  <% let monthDay= comment.createdAt.toLocaleDateString('en-US', option1).split(" "); %>
                  <h5><%= comment.user.firstName %> <%= comment.user.lastName %></h5><h6 class="post-time"><%= monthDay[0].substring(0,3) %> <%= monthDay[1]%></h6>

                </div>

                <!--comment body-->
                <div class="comment-body">
                  <p><%= comment.content %></p>
                </div>

                <!--Likes & reply tags-->
                <!--<a href="/category/<%= postDoc[0].category %>/<%= postDoc[0]._id %>/<%= comment._id %>"></a>-->
                <div class="comment-actions">
                  <p class="likes"><i class="fas fa-heart" onclick="showLikes2('<%=comment._id%>',event)" data-post-id="<%= comment._id %>"></i></p>
                  <p class="no-likes" id="<%=comment._id%>"><%= comment.likes %></p>
                  <p class="reply-click" onclick="showElements('reply-input<%=commentIndex%>')">Reply</p>
                  <div class="flag report"><i class="fas fa-flag" style="display:block;"></i>
                    <div class="report-text">
                      <p id="abusive" onclick="reportComment('<%= comment._id %>',event)">flag as abusive</p>
                      <p id="disinformation" onclick="reportComment('<%= comment._id %>',event)">flag as disinformation</p>
                    </div>
                  </div>
                </div>


                <!--comment box for reply-->
                <div class="row" id="reply-input<%=commentIndex%>" style="display:none;">
                  <div class="comment-content">
                    <h6 class="comment-title">Your email address will not be pushed. Required fields are marked</h6>
                    <div class="comment-input">
                      <form action="/reply" method="POST">
                        <div class="form-group">
                          <textarea class="form-control" rows="8" name="content" placeholder="Your Reply" style="border: 1px solid black;"></textarea>
                        </div>
                        <div class="form-group login">
                          <div class="guest">
                            <h5>Post as Guest</h5>
                            <input type="text" class="form-control" name="fname" placeholder="FirstName" required style="border: 1px solid black;">
                            <input type="text" class="form-control" name="lname" placeholder="LastName" required style="border: 1px solid black;">
                            <input type="email" class="form-control" name="email" placeholder="Email" required style="border: 1px solid black;">
                            <input type="hidden" name="commentId" value="<%= comment._id %>">
                            <input type="hidden" name="category" value="<%= postDoc[0].category %>">
                            <input type="hidden" name="postId" value="<%= postDoc[0]._id %>">
                          </div>
                          <div class="social-login">
                            <h5>Log in</h5>
                            <i class="fab fa-facebook-square"></i>
                            <i class="fab fa-google"></i>
                            <i class="fab fa-instagram"></i>
                            <i class="fab fa-twitter-square"></i>
                          </div>
                        </div>
                        <div class="form-group">
                          <button type="submit" class="btn btn-comment form-control">Reply</button>
                        </div>
                        
                      </form>
                    </div>
                  </div>
                </div>

                <!--reply section-->
                <% if(replyDoc.length>0){%>
                  <% replyDoc.forEach(function(reply){%>
                    <% replyIndex++ %>
                    <% if(reply.commentId===comment._id.toString()){%>
                      <div class="reply-section">
                        <!--user image section-->
                        <div class="user-image reply">
                          <img src="img/profile_avatar.png" alt="user-image">
                        </div>
                        <!--reply text section-->
                        <div class="comment-text">
                          <!--reply head-->
                          <div class="row comment-header">
                            <% let option2={month: 'long', day: 'numeric'} %>
                            <% let monthDay2= reply.createdAt.toLocaleDateString('en-US', option2).split(" "); %>
                            <h5><%= reply.user.firstName %> <%= reply.user.lastName %></h5><h6 class="post-time"><%= monthDay2[0].substring(0,3) %> <%= monthDay2[1]%></h6>
          
                          </div>
          
                          <!--reply body-->
                          <div class="repy-body">
                            <p><%= reply.content %></p>
                          </div>
          
                          <!--Likes & reply tags-->
                          <div class="comment-actions">
                            <p class="likes"><i class="fas fa-heart" onclick="showLikes2('<%=reply._id %>',event)" data-reply-id="<%= reply._id %>"></i></p><p class="no-likes" id="<%=reply._id %>"><%= reply.likes %></p>
                            <p class="reply-click" onclick="showElements('reply-input<%=commentIndex%>')">Reply</p>
                            <div class="flag report" style="margin-left: 50%;"><i class="fas fa-flag" style="display:block;"></i>
                              <div class="report-text">
                                <p onclick="reportComment('<%= reply._id %>',event)">flag as abusive</p>
                                <p onclick="reportComment('<%= reply._id %>',event)">flag as disinformation</p>
                              </div>
                            </div>
                          </div>
          
                          <!--comment box for reply-->
                          <div class="row" id="reply-input<%=replyIndex %>" style="display:none;">
                            <div class="card my-4">
                              <h5 class="card-header">Leave a Reply:</h5>
                              <div class="card-body">
                                <form action="/reply" method="POST">
                                  <div class="form-group">
                                    <textarea class="form-control" rows="4" name="content"></textarea>
                                  </div>
                                  <div class="form-group login">
                                    <div class="social-login">
                                      <h5>Log in</h5>
                                      <i class="fab fa-facebook-square"></i>
                                      <i class="fab fa-google"></i>
                                      <i class="fab fa-instagram"></i>
                                      <i class="fab fa-twitter-square"></i>
                                    </div>
                                    <div class="guest">
                                      <h5>Post as Guest</h5>
                                      <input type="text" class="form-control" name="fname" placeholder="FirstName" required>
                                      <input type="text" class="form-control" name="lname" placeholder="LastName" required>
                                      <input type="email" class="form-control" name="email" placeholder="Email" required>
                                      <input type="hidden" name="commentId" value="<%= comment._id %>">
                                      <input type="hidden" name="category" value="<%= postDoc[0].category %>">
                                      <input type="hidden" name="title" value="<%= postDoc[0].title %>">
                                    </div>
                                  </div>
                                  <div class="form-group">
                                    <button type="submit" class="btn btn-primary form-control">Reply</button>
                                  </div>
                                  
                                </form>
                              </div>
                            </div>
                          </div>
                          <!--reply text-->
                         
                        </div>
                      </div>


                    <%}%>
                  <%})%>
                <%}%>
                
               
              </div>
            </div>

          <%})%>
          
          
        </div>
        

      </div>

      <!-- Sidebar Widgets Column -->
      <%- include("partials/aside"); -%>
      <!-- /.row -->
    </div>
</div>
<%- include("partials/footer"); -%>
